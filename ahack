#!/bin/zsh

# method to call 'cmd' in cmd-***/p-cmd-*** directories.
# argument 1: the absolute path of current folder
# argument 2: the sub-command
# argument 3: the arguments for sub-command
# 
# example: 'subcmd /tmp/abc subcmd1 x y z' will try to execute
#   - /tmp/abc/cmd-subcmd1/cmd x y z
# if Ôºètmp/abc/cmd-subcmd1 does not exist, then fallback to execute
#   - /tmp/abc/p-cmd-subcmd1/cmd x y z
#
subcmd() {
  local mydir=$1
  local subdir=$mydir/cmd-$2
  if [[ ! -a $subdir ]] then
    subdir=$mydir/p-cmd-$2
  fi
  if [[ ! -a $subdir ]] then
    subdir=$mydir/a-cmd-$2
  fi
  if [[ ! -a $subdir ]] then
    echo 'no such folder:' $subdir
    return
  fi

  local nextCmd=$subdir/cmd
  if [[ ! -a $nextCmd ]] then
    echo 'no such file:' $nextCmd
    return
  else
    shift # remove $1:mydir
    shift # remove $2:subcmd
    source $nextCmd "$@"
  fi
}

source `dirname $0`/cmd "$@"
