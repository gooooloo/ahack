#!/bin/zsh

local mydir=`dirname $0`
nextCmdImpl() {
  local aliasFileName=.alias
  local subdir=$mydir/cmd-$1
  if [[ ! -a $subdir ]] then
    subdir=$mydir/p-cmd-$1
  fi
  if [[ ! -a $subdir ]] then
    subdir=$mydir/$(cat $aliasFileName | cut -d'=' -f2-)
  fi
  if [[ ! -a $subdir ]] then
    echo 'no such folder:' $subdir
    return
  fi

  local nextCmd=$subdir/cmd
  if [[ ! -a $nextCmd ]] then
    echo 'no such file:' $nextCmd
    return
  else
    shift
    source $nextCmd "$@"
  fi
}

ahackImpl() {

  if (( $# == 0 )) then
    echo 'arguments needed.'
    return
  fi

  nextCmdImpl "$@"
}

ahackImpl $@
