#!/bin/zsh

subcmd() {
  local mydir=$1
  local aliasFileName=.alias
  local subdir=$mydir/cmd-$2
  if [[ ! -a $subdir ]] then
    subdir=$mydir/p-cmd-$2
  fi
  if [[ ! -a $subdir ]] then
    subdir=$mydir/$(cat $aliasFileName | cut -d'=' -f2-)
  fi
  if [[ ! -a $subdir ]] then
    echo 'no such folder:' $subdir
    return
  fi

  local nextCmd=$subdir/cmd
  if [[ ! -a $nextCmd ]] then
    echo 'no such file:' $nextCmd
    return
  else
    shift
    shift
    source $nextCmd "$@"
  fi
}

if (( $# == 0 )) then
  echo 'arguments needed.'
  return
fi

subcmd `dirname $0` "$@"
